<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Travis STEM Night 2025: Teachable Machine Demo</title>

  <!-- TFJS + Teachable Machine -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.13.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <style>
    :root{
      --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8;
      --a:#60a5fa; --b:#22c55e; --warn:#f59e0b; --danger:#ef4444; --pink:#f472b6; --vio:#a78bfa;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% -20%, #1f2937, transparent),
                  radial-gradient(1000px 500px at 110% 0%, #1f2937, transparent),
                  var(--bg);
      color:var(--text);
    }
    header{ padding:24px 16px; text-align:center; }
    h1{ margin:0 0 6px; font-size:clamp(24px,3vw,36px) }
    .sub{ color:var(--muted); font-size:clamp(14px,2vw,16px) }
    .wrap{ max-width:1100px; margin:0 auto; padding:16px }
    .grid{ display:grid; gap:16px; grid-template-columns: 1.2fr 1fr; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr } }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.06);
      border-radius:16px; padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    .stage{ display:grid; gap:12px; grid-template-rows: auto 1fr auto; min-height:520px; }
    .videoWrap{
      position:relative; border-radius:16px; overflow:hidden;
      background:#000; min-height:320px; display:flex; align-items:center; justify-content:center;
    }
    canvas, video{max-width:100%; height:auto; display:block}
    .badge{ position:absolute; top:12px; left:12px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); padding:6px 10px; border-radius:999px; font-size:12px }
    .overlay{
      position:absolute; inset:0; pointer-events:none; display:flex; align-items:center; justify-content:center;
      font-size:min(18vw,120px); font-weight:900; letter-spacing:1px;
      text-shadow:0 12px 36px rgba(0,0,0,0.6);
      opacity:0; transform:scale(.98); transition:opacity .15s ease, transform .15s ease;
    }
    .overlay.show{ opacity:1; transform:scale(1) }
    .overlayTag{
      position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
      padding:8px 14px; font-weight:800; border-radius:12px;
      background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25);
      font-size:clamp(14px,2.5vw,18px)
    }
    .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center }
    button{
      background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.18); color:var(--text);
      padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;
      transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
      user-select:none; text-align:center; display:inline-flex; gap:8px; align-items:center;
    }
    button:hover{ transform:translateY(-1px); box-shadow:0 8px 20px rgba(0,0,0,.35) }
    button.primary{ border-color:rgba(34,197,94,.6); }
    button.warn{ border-color:rgba(245,158,11,.6); }
    button.ghost{ background:transparent; border-color:rgba(255,255,255,.12) }

    .pred{ display:grid; gap:14px; }
    .row{
      display:grid; grid-template-columns: auto 1fr auto; gap:10px; align-items:center;
      padding:10px; border-radius:12px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,.08)
    }
    .label{ display:flex; align-items:center; gap:10px; font-weight:800; font-size:18px }
    .emoji{ font-size:28px }
    .bar{ width:100%; height:14px; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.1) }
    .bar > span{ display:block; height:100%; width:0%; transition: width .35s ease }
    .pct{ min-width:64px; text-align:right; font-variant-numeric: tabular-nums; color:var(--muted) }
    .howto{ color:var(--muted); font-size:14px; line-height:1.5 }
    .howto ul{ margin:10px 0 0 18px }
  </style>
</head>
<body>
  <header>
    <h1>Travis STEM Night 2025: Google‚Äôs Teachable Machine Demo</h1>
    <div class="sub">Hold up an animal picture or toy to the camera ‚Äî the computer will try to recognize it!</div>
  </header>

  <div class="wrap grid">
    <section class="card stage" aria-label="Camera Stage">
      <div class="videoWrap" id="stage">
        <div class="badge" id="status">Loading model‚Ä¶</div>
        <div class="overlay" id="overlay">
          <div id="overlayText">LABEL</div>
          <div class="overlayTag" id="overlayPct">100%</div>
        </div>
      </div>

      <div class="controls">
        <button class="primary" id="startCam">üé• Start Camera</button>
        <button class="warn" id="stopCam">‚èπ Stop Camera</button>
        <button class="ghost" id="pause">‚è∏ Pause</button>
        <button class="ghost" id="resume">‚ñ∂Ô∏è Resume</button>
        <button class="ghost" id="reset">‚ôªÔ∏è Reset</button>
      </div>

      <div class="howto">
        <strong>Tips:</strong>
        <ul>
          <li>Fill the frame with the animal. Keep steady.</li>
          <li>Good light helps! Try not to block the camera.</li>
          <li>Try side angles ‚Äî see if the computer still gets it right.</li>
        </ul>
      </div>
    </section>

    <aside class="card pred" id="predictions"></aside>
  </div>

  <script>
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/xc-B8YuD7/"; // <-- Replace with your model URL
    const THRESHOLD = 0.75, EMA_ALPHA = 0.35, LOCK_MS = 1000, LOOP_MS = 160;
    let model, webcam, running=false, usingWebcam=false, paused=false;
    let offscreenCanvas, offctx;
    let classNames=[];
    const classEmojis={"Hen":"üêî","Horse":"üêé","Sheep":"üêë","Cow":"üêÑ","Box":"üì¶"};
    const ema={}, stageEl=document.getElementById("stage");
    const overlayEl=document.getElementById("overlay"),overlayText=document.getElementById("overlayText"),overlayPct=document.getElementById("overlayPct");
    const statusEl=document.getElementById("status");
    const $=id=>document.getElementById(id);
    $("startCam").onclick=startCamera; $("stopCam").onclick=stopCamera;
    $("pause").onclick=()=>paused=true; $("resume").onclick=()=>paused=false; $("reset").onclick=resetAll;

    (async function init(){
      try{
        status("Loading model‚Ä¶");
        model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
        const md = await fetch(MODEL_URL + "metadata.json").then(r=>r.json());
        if(Array.isArray(md.labels)) classNames = md.labels;
        status("Model loaded ‚úì Click ‚ÄúStart Camera‚Äù to begin");
        setupPredictionsPanel();
        offscreenCanvas=document.createElement("canvas"); offscreenCanvas.width=400; offscreenCanvas.height=400;
        offctx=offscreenCanvas.getContext("2d",{alpha:false,desynchronized:true});
        classNames.forEach(n=>ema[n]=0);
      }catch(err){console.error(err);status("Error loading model. Check MODEL_URL.",true);}
    })();

    function setupPredictionsPanel(){
      const predDiv=document.getElementById("predictions");
      predDiv.innerHTML="";
      classNames.forEach((name,i)=>{
        const row=document.createElement("div");
        row.className="row";
        row.innerHTML=`<div class="label"><span class="emoji" id="emoji${i}">${classEmojis[name]||"üü¢"}</span><span id="name${i}">${name}</span></div>
                       <div class="bar"><span id="bar${i}"></span></div>
                       <div c
